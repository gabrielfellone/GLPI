!function($){$.fn.imagePaste=function(params){function init(){this.pasteddata="",this.file="",$("#image_paste").append("<div id='desc_paste_image' \n                  contenteditable='true' \n                  onpaste='tinyMCE.imagePaste.handlepaste(this, event)'><b>"+params.lang.pasteimage+"</b></div>\n               <input style='display:none' id='fileupload"+params.rand+"' type='file' name='stock_image[]' \n                  data-url='"+params.root_doc+"/front/fileupload.php?name=stock_image&showfilesize="+params.showfilesize+"'>\n               <div id='image_paste_result' style='display:none'></div>\n               <div id='image_paste_result2'>\n                  <div id='progress"+params.rand+"' style='display:none'>\n                     <div class='uploadbar' style='width: 0%;'></div>\n                  </div>\n                  <div id='filedata"+params.rand+"'></div>\n               </div>\n               <div id='paste_image_menu' class='center' style='display:none'> \n                  <a id='upload_image' class='vsubmit'>"+params.lang.save+"</a>\n                  <a id='clear_image' class='vsubmit'>"+params.lang.cancel+"</a>\n               </div>"),$("#desc_paste_image").focusout(function(){$("#image_paste").css({border:"1px dashed #cccccc"})}),$("#image_paste").css({cursor:"pointer","min-height":"65px","max-height":"500px"}),$("#desc_paste_image").css({"max-height":"475px","min-height":"67px",overflow:"auto"}).focus(function(){$("#image_paste").css({border:"1px dashed orange"})}),$("#image_paste_result").css({margin:"2px 0px 2px 0px"}),$("#paste_image_menu").css({"margin-top":"5px",height:"25px"}),imagepaste.btnClear=$("#clear_image"),imagepaste.btnClear.click(function(){clearImage()}),imagepaste.btnUpload=$("#upload_image"),imagepaste.btnUpload.click(function(){stockImage()}),imagepaste.menu=$("#paste_image_menu"),$("#desc_paste_image").is(":focus")&&$(document).keydown(function(a){a.ctrlKey&&86==a.keyCode&&imagepaste.handlepaste($("#desc_paste_image"),a)}),$("#image_paste").bind("drop",function(a,b){$("#desc_paste_image").focus()})}function error(a){$("#image_paste_result").html("<b class='red'>"+a+"</b>").show().delay(2e3).fadeOut("slow")}function waitforpastedata(a,b){if(a.childNodes&&a.childNodes.length>0){if("IMG"!==a.firstChild.tagName)return $(a).html("<b>"+b+"</b>"),error(params.lang.itemnotfound),!1;imagepaste.processpaste(a,b)}else that={e:a,s:b},that.callself=function(){waitforpastedata(that.e,that.s)},setTimeout(that.callself,20)}function clearImage(){imagepaste.menu.hide(),$("#desc_paste_image").html("<b>"+params.lang.pasteimage+"</b>"),imagepaste.pasteddata=void 0,imagepaste.file=void 0}function stockImage(){if(null!=imagepaste.file)var fileList=new Array(imagepaste.file);else var fileList=new Array(dataURItoBlob($("#pasteddata").attr("src")));imagepaste.stockimage=!0,eval("uploadFile"+params.rand+"()"),$("#fileupload"+params.rand).fileupload("add",{files:fileList}),clearImage()}function dataURItoBlob(a){var b,c;b=-1!==a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURI(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0];for(var d=new Array,e=0;e<b.length;e++)d[e]=b.charCodeAt(e);var f=new Blob([new Uint8Array(d)],{type:c});return f.name=params.filename,f}function generateFileName(){return"pastedImage"}var imagepaste=this;return init(),this.handlepaste=function(a,b){var c=$(a).html();if(b&&b.clipboardData&&b.clipboardData.getData&&b.clipboardData.items){var d=b.clipboardData.items;if(void 0!=d)for(var e=0;e<d.length;++e)if("file"==d[e].kind&&-1!==d[e].type.indexOf("image/")){var f=d[e].getAsFile(),g=new FileReader;g.onload=function(b){$(a).html(b.target.result),imagepaste.processpaste(a,c)},g.readAsDataURL(f)}else error(params.lang.itemnotfound);return b.preventDefault&&(b.stopPropagation(),b.preventDefault()),!1}return $(a).html(""),waitforpastedata(a,c),$(a).html("<b>"+c+"</b>"),!0},this.processpaste=function(a,b,c){void 0!=c&&null!=c&&(imagepaste.file=c),void 0!=a.firstChild&&"IMG"===a.firstChild.tagName?imagepaste.pasteddata=a.firstChild.src:imagepaste.pasteddata=$(a).html();var d=!1;switch(imagepaste.pasteddata.substr(0,imagepaste.pasteddata.indexOf(";"))){case"data:image/gif":case"data:image/jpg":case"data:image/jpeg":case"data:image/png":d=!0}if(""!=imagepaste.pasteddata&&d){$(a).html("<b>"+b+"<b>");var e=document.createElement("img");e.src=imagepaste.pasteddata,imagepaste.pasteddata=void 0,e.id="pasteddata",$("#desc_paste_image").html(e),$($("#pasteddata")).load(function(){$("#pasteddata").height()>params.maxsize||$("#pasteddata").width()>params.maxsize?(error(params.lang.toolarge),clearImage()):(jQuery().Jcrop&&jQuery(function(a){a("#pasteddata").Jcrop({onSelect:imagepaste.setCoords,onChange:imagepaste.setCoords})}),imagepaste.menu.show())})}else error(params.lang.itemnotfound),clearImage()},imagepaste.setCoords=function(a){imagepaste.imageCoordinates={img_x:a.x,img_y:a.y,img_w:a.w,img_h:a.h}},this}}(jQuery),function($){$.fn.IE_support_imagePaste=function(params){function init(){$("#image_paste").append("<form name='image_paste_form' action='#none'>\n               <div style='display:none'>\n                  <applet id='desc_paste_image'\n                          archive='"+params.root_doc+"/lib/jqueryplugins/imagepaste/IE_support/Supa.jar'\n                          code='de.christophlinder.supa.SupaApplet'>\n                     <param name='imagecodec' value='png'>\n                     <param name='trace' value='true'>\n                     <param name='encoding' value='base64'>\n                     <param name='previewscaler' value='fit to canvas'>\n                  </applet> \n               </div>\n            </form>\n            <div id='desc_paste_image2'><b>"+params.lang.pasteimage+"</b></div>\n            <input style='display:none' id='fileupload"+params.rand+"' type='file' name='stock_image[]' \n               data-url='"+params.root_doc+"/front/fileupload.php?name=stock_image&showfilesize="+params.showfilesize+"'>\n            <div id='image_paste_result' style='display:none'></div>\n            <div id='image_paste_result2'>\n               <div id='progress"+params.rand+"' style='display:none'>\n                  <div class='uploadbar' style='width: 0%;'></div>\n               </div>\n               <div id='filedata"+params.rand+"'></div>\n            </div>\n            <div id='paste_image_menu' class='center' style='display:none'>\n               <a id='upload_image' class='vsubmit'>"+params.lang.save+"</a>\n               <a id='clear_image' class='vsubmit'>"+params.lang.cancel+"</a>\n            </div>"),$("#image_paste_result").css({margin:"2px 0px 2px 0px"}),$("#paste_image_menu").css({"margin-top":"5px",height:"25px"}),$("#desc_paste_image2").focusout(function(){$("#image_paste").css({border:"1px dashed #cccccc"})}),$("#image_paste").css({cursor:"pointer","max-height":"500px","max-width":"700px"}),$("#desc_paste_image2").css({"max-height":"470px","max-width":"700px",overflow:"auto"}).focus(function(){$("#image_paste").css({border:"1px dashed orange"})}),$(document).keydown(function(a){a.ctrlKey&&86==a.keyCode&&processpaste()}),imagepaste.menu=$("#paste_image_menu");var a=$("#clear_image");a.click(function(){clearImage()}),imagepaste.pasteddata=void 0,imagepaste.stockimage=void 0}function error(a){$("#image_paste_result").html("<b class='red'>"+a+"</b>").show().delay(2e3).fadeOut("slow")}function Supa(){this.ping=function(a){try{return a.ping()}catch(b){return!1}},this.isArray=function(a){return-1==a.constructor.toString().indexOf("Array")?!1:!0}}function supa(){return new Supa}function processpaste(){var a=new Supa,b=document.getElementById("desc_paste_image");$("#image_paste_result").html("").hide();try{if(!a.ping(b))throw"SupaApplet is not loaded (yet)";var c=b.pasteFromClipboard();switch(c){case 0:var d=document.createElement("img");d.src="data:image/png;base64,"+b.getEncodedString(),d.id="pasteddata",$("#desc_paste_image2").html(d),$($("#pasteddata")).load(function(){if($("#pasteddata").height()>params.maxsize||$("#pasteddata").width()>params.maxsize)error(params.lang.toolarge),clearImage();else{jQuery().Jcrop&&jQuery(function(a){a("#pasteddata").Jcrop({onSelect:imagepaste.setCoords,onChange:imagepaste.setCoords})});var a=$("#upload_image");a.click(function(){stockImage(b.getEncodedString()),clearImage()}),imagepaste.menu.show()}});break;case 1:error("Unknown Error");break;case 2:error("Empty clipboard");break;case 3:error(params.lang.itemnotfound);break;case 4:error("Clipboard in use by another application. Please try again in a few seconds.");break;default:error(params.lang.itemnotfound)}}catch(e){throw error(e),e}}function stockImage(pasteddata){if(null!=pasteddata||void 0!=pasteddata){var fileList=new Array(b64toBlob(pasteddata));imagepaste.pasteddata=!0,imagepaste.stockimage=!0,eval("uploadFile"+params.rand+"()"),$("#fileupload"+params.rand).fileupload("add",{files:fileList})}clearImage()}function b64toBlob(a,b,c){function d(a){return a.charCodeAt(0)}b=b||"image/png",c=c||1024,a=a.replace(/\s/g,"");for(var e=atob(a),f=[],g=0;g<e.length;g+=c){var h=e.slice(g,g+c),i=Array.prototype.map.call(h,d),j=new Uint8Array(i);f.push(j)}var k=new Blob(f,{type:b});return k.name=params.filename,k}function clearImage(){document.getElementById("desc_paste_image").clear(),$("#desc_paste_image2").html("<b>"+params.lang.pasteimage+"</b>"),imagepaste.menu.hide()}var imagepaste=this;return init(),imagepaste.setCoords=function(a){imagepaste.imageCoordinates={img_x:a.x,img_y:a.y,img_w:a.w,img_h:a.h}},this}}(jQuery);